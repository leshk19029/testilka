local module = {}

local connection = nil

function module.toggleAntiEffects(state)
    if state then
        -- Включаем Anti Effects
        if connection then
            connection:Disconnect()
        end
        
        local Lighting = game:GetService("Lighting")
        local Camera = workspace.CurrentCamera
        
        local function processEffects()
            -- Удаляем все эффекты
            for _, child in ipairs(Lighting:GetChildren()) do
                if child.Name == "DiscoEffect" or child.Name == "Blur" or child.Name == "BeeBlur" or child.Name == "ColorCorrection" then
                    child:Destroy()
                end
            end
            
            -- Фиксируем FOV
            if Camera then
                Camera.FieldOfView = 70
            end
        end
        
        -- Запускаем сразу
        processEffects()
        
        -- Создаем постоянное соединение
        connection = game:GetService("RunService").Heartbeat:Connect(processEffects)
        
        -- Слушатель для новых эффектов
        Lighting.ChildAdded:Connect(function(child)
            if child.Name == "DiscoEffect" or child.Name == "Blur" or child.Name == "BeeBlur" or child.Name == "ColorCorrection" then
                child:Destroy()
            end
        end)
    else
        -- Выключаем
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end

return module
