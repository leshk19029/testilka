local Player = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")

-- Настройки
local FALL_GRAVITY = 3
local NORMAL_GRAVITY = Workspace.Gravity
local scriptActive = true
local gravityEnabled = false

-- Создаем интерфейс
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FallGravityControl"
screenGui.Parent = CoreGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 150, 0, 80)
frame.Position = UDim2.new(0.8, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BackgroundTransparency = 0.3
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 8)
uiCorner.Parent = frame

-- Заголовок
local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(1, 0, 0, 20)
titleText.Position = UDim2.new(0, 0, 0, 5)
titleText.BackgroundTransparency = 1
titleText.Text = "FALL GRAVITY"
titleText.TextColor3 = Color3.fromRGB(200, 200, 200)
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 16
titleText.TextXAlignment = Enum.TextXAlignment.Center

-- Переключатель гравитации
local gravityToggle = Instance.new("TextButton")
gravityToggle.Size = UDim2.new(0, 50, 0, 25)
gravityToggle.Position = UDim2.new(0.05, 0, 0.4, 0)
gravityToggle.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
gravityToggle.Text = "OFF"
gravityToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
gravityToggle.Font = Enum.Font.GothamBold
gravityToggle.TextSize = 14

-- Текст статуса
local statusText = Instance.new("TextLabel")
statusText.Size = UDim2.new(1, 0, 0, 20)
statusText.Position = UDim2.new(0, 0, 0.75, 0)
statusText.BackgroundTransparency = 1
statusText.Text = "Standing"
statusText.TextColor3 = Color3.fromRGB(200, 200, 200)
statusText.Font = Enum.Font.Gotham
statusText.TextSize = 12
statusText.TextXAlignment = Enum.TextXAlignment.Center

-- Иерархия объектов
titleText.Parent = frame
gravityToggle.Parent = frame
statusText.Parent = frame
uiCorner.Parent = frame
frame.Parent = screenGui

-- Переменные для отслеживания состояния
local isFalling = false
local wasOnGround = false

-- Функция включения/выключения системы
local function toggleGravitySystem()
    gravityEnabled = not gravityEnabled
    
    if gravityEnabled then
        gravityToggle.Text = "ON"
        gravityToggle.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        statusText.Text = "Active"
    else
        gravityToggle.Text = "OFF"
        gravityToggle.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        statusText.Text = "Disabled"
        -- Восстанавливаем нормальную гравитацию при выключении
        Workspace.Gravity = NORMAL_GRAVITY
    end
end

-- Обработчик клика по переключателю
gravityToggle.MouseButton1Click:Connect(toggleGravitySystem)

-- Функция проверки состояния падения
local function checkFallingState()
    if not gravityEnabled or not Player.Character then
        return
    end
    
    local humanoid = Player.Character:FindFirstChild("Humanoid")
    local rootPart = Player.Character:FindFirstChild("HumanoidRootPart")
    
    if humanoid and rootPart then
        local isOnGround = humanoid.FloorMaterial ~= Enum.Material.Air
        
        -- Определяем, падаем ли мы
        if not isOnGround and rootPart.Velocity.Y < -2 then
            if not isFalling then
                isFalling = true
                Workspace.Gravity = FALL_GRAVITY
                statusText.Text = "Falling (G: " .. FALL_GRAVITY .. ")"
            end
        else
            if isFalling then
                isFalling = false
                Workspace.Gravity = NORMAL_GRAVITY
                statusText.Text = "Standing (G: " .. NORMAL_GRAVITY .. ")"
            else
                statusText.Text = isOnGround and "Standing" or "Jumping"
            end
        end
        
        wasOnGround = isOnGround
    end
end

-- Обработчик F2 для выключения скрипта
UIS.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F2 then
        scriptActive = false
        -- Восстанавливаем оригинальную гравитацию перед выходом
        Workspace.Gravity = NORMAL_GRAVITY
        screenGui:Destroy()
        print("Скрипт выключен, гравитация восстановлена")
    end
end)

-- Основной цикл проверки состояния
RunService.Heartbeat:Connect(checkFallingState)

print("Fall Gravity контроллер загружен. Нажмите F2 для выключения.")
