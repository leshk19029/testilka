local SpeedBoostModule = {}
SpeedBoostModule.Enabled = false
SpeedBoostModule.CurrentSpeed = 16
SpeedBoostModule.VelocityConnection = nil
SpeedBoostModule.Player = game:GetService("Players").LocalPlayer

function SpeedBoostModule:Enable()
    local RunService = game:GetService('RunService')
    
    local character = self.Player.Character
    if not character then return end
    
    self:Disable()

    self.VelocityConnection = RunService.Heartbeat:Connect(function()
        if not self.Enabled then return end
        
        character = self.Player.Character
        if not character or not character.Parent then return end
        
        local humanoid = character:FindFirstChild('Humanoid')
        local rootPart = character:FindFirstChild('HumanoidRootPart')
        
        if humanoid and rootPart and humanoid.MoveDirection.Magnitude > 0 then
            local moveDirection = humanoid.MoveDirection
            local velocity = moveDirection * self.CurrentSpeed
            rootPart.Velocity = Vector3.new(velocity.X, rootPart.Velocity.Y, velocity.Z)
        end
    end)
end

function SpeedBoostModule:Disable()
    if self.VelocityConnection then
        self.VelocityConnection:Disconnect()
        self.VelocityConnection = nil
    end
end

function SpeedBoostModule:SetSpeed(speed)
    self.CurrentSpeed = math.clamp(speed, 1, 45)
end

function SpeedBoostModule:SetEnabled(state)
    self.Enabled = state
    if state then
        self:Enable()
    else
        self:Disable()
    end
end

-- Обработка смены персонажа
SpeedBoostModule.Player.CharacterAdded:Connect(function()
    if SpeedBoostModule.Enabled then
        SpeedBoostModule:Disable()
        SpeedBoostModule:Enable()
    end
end)

SpeedBoostModule.Player.CharacterRemoving:Connect(function()
    SpeedBoostModule:Disable()
end)

return SpeedBoostModule
