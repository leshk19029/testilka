local module = {}

local speedEnabled = false
local currentSpeed = 25
local velocityConnection = nil

local function applyVelocity()
    if not speedEnabled then return end
    
    local player = game:GetService('Players').LocalPlayer
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    
    if humanoid and rootPart then
        local moveDirection = humanoid.MoveDirection
        if moveDirection.Magnitude > 0 then
            local velocity = moveDirection * currentSpeed
            rootPart.Velocity = Vector3.new(velocity.X, rootPart.Velocity.Y, velocity.Z)
        else
            rootPart.Velocity = Vector3.new(0, rootPart.Velocity.Y, 0)
        end
    end
end

function module.toggleSpeedBoost(state)
    speedEnabled = state
    
    if speedEnabled then
        if velocityConnection then
            velocityConnection:Disconnect()
        end
        velocityConnection = game:GetService('RunService').RenderStepped:Connect(applyVelocity)
    else
        if velocityConnection then
            velocityConnection:Disconnect()
            velocityConnection = nil
        end
    end
end

function module.setSpeed(value)
    currentSpeed = math.clamp(value, 1, 45)
end

return module
