local module = {}

local connection = nil

function module.toggleAntiEffects(state)
    if state then
        -- Включаем Anti Effects
        if connection then
            connection:Disconnect()
        end
        
        local lighting = game:GetService("Lighting")
        local camera = game:GetService("Workspace").CurrentCamera
        
        -- Функция для обработки эффектов
        local function processEffects()
            -- Удаляем все эффекты
            for _, child in ipairs(lighting:GetChildren()) do
                if table.find({"DiscoEffect", "Blur", "BeeBlur", "ColorCorrection"}, child.Name) then
                    child:Destroy()
                end
            end
            
            -- Фиксируем FOV
            if camera then
                camera.FieldOfView = 70
            end
        end
        
        -- Запускаем сразу и создаем соединение
        processEffects()
        connection = game:GetService('RunService').Heartbeat:Connect(processEffects)
        
        -- Слушатель для новых эффектов
        lighting.ChildAdded:Connect(function(child)
            if table.find({"DiscoEffect", "Blur", "BeeBlur", "ColorCorrection"}, child.Name) then
                child:Destroy()
            end
        end)
    else
        -- Выключаем Anti Effects
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end

return module
